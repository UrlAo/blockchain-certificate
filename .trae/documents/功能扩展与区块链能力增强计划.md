## 目标
- 在保留现有“哈希登记 + 验证”模型的同时，扩展更丰富的链上能力，提升可用性、安全性与可扩展性。
- 以模块化方式推进：合约功能增强 → 前端交互与引导升级 → 测试与部署到测试网。

## 路线选择
- 方案 A（保持 Registry 形态）：继续使用 `CertificateRegistry` 的 `mapping(bytes32 => Certificate)`，逐步叠加权限、撤销、批量、IPFS、签名等能力。
- 方案 B（证书 NFT/SBT 化）：将证书铸造成不可转让的 SBT（参考 ERC-5192 或自定义锁定的 ERC-721），保留哈希验真。优点：标准化、易索引、直观所有权；代价：前后端与数据结构的重构。
- 建议先实施方案 A（改动小、见效快），后续以兼容方式逐步引入方案 B（SBT）。

## Phase 1：合约能力增强（优先）
1. 撤销与状态管理
- 结构扩展：`Certificate{..., revoked: bool, revokeReason: string, revokeDate: uint256}`（基于 `contracts/Certificate.sol:7-13`）。
- 新增函数：`revokeCertificate(bytes32 certHash, string reason)`（`onlyAdmin`）；事件 `CertificateRevoked(certHash, reason)`。
- 验证返回包含撤销信息，前端给出“已撤销”提示。

2. 多发行人/角色管理
- 引入 OpenZeppelin `AccessControl` 或轻量版：`mapping(address => bool) issuers`、`modifier onlyIssuer`；`addIssuer(address)`/`removeIssuer(address)` 由管理员维护；`issueCertificate` 改为 `onlyIssuer`。
- 事件：`IssuerAdded(address) / IssuerRemoved(address)`。

3. 批量发行
- 两种模式：
  - 直接批量：`issueBatch(bytes32[] hashes, string[] ids, names, degrees)`（按 gas 优化拆分）；
  - Merkle 批：存储批次根 `issueBatchRoot(bytes32 root, string batchId)`，验证时提交 `proof`（更省 gas，适合大量证书）。

4. IPFS 集成
- 结构扩展：`ipfsCid: string`（可选）；
- 前端可上传到 IPFS（本地先以占位字段录入），展示跳转链接；避免链上存文件，链上仅存 `cid + hash`。

5. EIP-712 签名发行（提升 UX）
- 管理员线下签名 `TypedData{certHash, studentId, ...}`，任何地址可带签名上链执行 `issueWithSig(signature, payload)`（合约校验 signer 是否为发行人）。
- 降低“必须用管理员账户发交易”的限制，提高可用性。

6. 安全与治理
- `Pausable`（紧急暂停）与 `Ownable`（或 `AccessControl` 的 `DEFAULT_ADMIN_ROLE`）；
- 事件完整化与严格 require 提示；
- 读接口补充：`getCertificate(certHash)` 返回结构体，减少位置参数的易错性。

## Phase 2：前端与交互增强
- 权限与状态面板：显示当前地址是否发行人/管理员、余额、网络；撤销按钮与原因输入框（仅发行人/管理员可见）。
- 批量上传与 Merkle 证明：支持选择批量文件，自动生成根与证明（前端或后端辅助脚本）。
- IPFS 入口：在发行表单中增加 `cid` 输入或上传入口；验证页展示 `查看原文件` 链接（若提供）。
- EIP-712 流程：
  - 生成待签名数据 → 钱包签名 → 携签名调用上链；
  - UI 引导与失败提示更加清晰。
- 组件化提示：统一成功/失败 toast、进度条，支持复制 `txHash`/`fileHash`/`cid`。

## Phase 3：测试与部署
- Hardhat 单元测试：
  - 权限边界：非发行人不可发行，撤销仅管理员；
  - 发行→验证→撤销→再验证；
  - 批量与 Merkle 证明正确性；
  - EIP-712 验签与重放攻击防护（nonce 或 `hash used` 标记）。
- 覆盖率与 CI：添加 GitHub Actions 运行 `npm test` + 编译检查；
- 测试网部署（Sepolia）：
  - 新增 `.env`（保存 RPC 与私钥），`hardhat.config` 增加 `sepolia` 网络；
  - 部署后写入 `frontend/config.js` 的地址；
  - 绝不提交任何私钥，文档引导用户自备。

## Phase 4：可选进阶
- SBT 模式：引入 ERC-721（不可转让），映射 `tokenId ↔ certHash`，保留现有接口做兼容；
- 索引与检索：The Graph 子图或简单后端服务，提供分页检索与审核列表；
- 升级性：采用 UUPS（OpenZeppelin）实现可升级合约（需代理部署与安全审查）；
- 隐私增强：探索 ZK 方案（属性证明，不泄露原文），作为独立模块渐进接入。

## 交付物与修改点
- 合约：`contracts/Certificate.sol` 扩展结构与方法，新增事件、角色与批量接口；
- 前端：表单与状态面板、批量/撤销/IPFS/EIP-712 流程；
- 脚本与工具：`scripts/deploy-<network>.js`、批量与 Merkle 生成脚本、签名辅助脚本；
- 测试：`test/certificate.test.ts` 全路径覆盖；
- 文档：README 增补新功能与测试网指南。

## 实施顺序与时间
- 先做 Phase 1 与部分 Phase 2（撤销、角色、批量-直接版、IPFS 字段、前端面板），随后补 EIP-712 与 Merkle 批；
- 配套测试与 CI；最后提供测试网投放。

请确认是否按以上计划推进。确认后我将开始实施 Phase 1 与核心前端改造，并在完成后通过本地与预览验证功能。